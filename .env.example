# ======================================================================
#                         Web Application Settings
# ======================================================================

# Web Application
PORT=5000
# Set to 'true' only for local development, never in production
FLASK_DEBUG=false

LANGSMITH_API_KEY=
LANGSMITH_PROJECT=
LANGCHAIN_TRACING_V2=true

# Add API key on API in production
# REACT_APP_API_KEY=

# API backend URL, useful for some deployments, but deaults to '/api'
# REACT_APP_API_BASE_URL=/evidencelab/api

# CORS allowed origins (comma-separated, e.g., https://yourdomain.com,https://api.yourdomain.com)
# Defaults to localhost:3000 and localhost:8000 if not set
CORS_ALLOWED_ORIGINS=https://yourdomain.com

# API server host binding (0.0.0.0 for Docker, 127.0.0.1 for local dev)
API_HOST=0.0.0.0
API_PORT=8000

# Rate Limits
RATE_LIMIT_DEFAULT=500/minute
RATE_LIMIT_SEARCH=500/minute

# Search concurrency guards (increase carefully; higher values can OOM)
# MAX_CONCURRENT_SEARCHES controls how many /search requests run at once.
MAX_CONCURRENT_SEARCHES=10
# MAX_CONCURRENT_RERANKS controls concurrent reranker inferences; keep low.
MAX_CONCURRENT_RERANKS=1

# Hard cap on Qdrant fetch size per query (always >= 1)
SEARCH_FETCH_LIMIT=50

# ======================================================================
#                        Vector DB Settings
# ======================================================================

# Data Path (for Docker volumes with symlinked data directories)
# If your ./data is a symlink to external storage, set the real path here
DATA_MOUNT_PATH=

# Local docker. This will be mapped to localhost:6333 for scripts running on host
QDRANT_HOST=http://qdrant:6333
QDRANT_API_KEY=

# Remote (needed for pushing local DB to remote)
QDRANT_REMOTE_HOST=http://evidencelab.ai:6333
QDRANT_REMOTE_API_KEY=

# Collection Names (for experimenting with different Qdrant settings)
DOCUMENTS_COLLECTION=documents
CHUNKS_COLLECTION=chunks

# QDRANT STORAGE & MEMORY OPTIMIZATION
# See: https://qdrant.tech/documentation/guides/optimize/

# Store original vectors on disk (saves RAM, slightly slower search)
VECTORS_ON_DISK=true

# Store HNSW index on disk (saves significant RAM, much slower search)
HNSW_ON_DISK=false

# Enable vector quantization to compress vectors in memory
# int8 = 4x compression, binary = 32x compression
ENABLE_QUANTIZATION=true

# Quantization type: int8 or binary
QUANTIZATION_TYPE=int8

# Keep quantized vectors in RAM (required for speed)
QUANTIZATION_ALWAYS_RAM=false

# Re-score top results with original vectors (better accuracy, slight speed cost)
QUANTIZATION_RESCORE=true

# QDRANT HNSW INDEX CONFIGURATION

# Number of edges per node in HNSW graph (range: 4-64)
# Higher = better recall but more memory. Recommended: 16
HNSW_M=16

# Accuracy during index construction (range: 10-500)
# Higher = better quality index but slower build time
HNSW_EF_CONSTRUCT=100

# QDRANT PERFORMANCE TUNING

# Number of segments (0=auto, 2=max throughput, 16=min latency)
DEFAULT_SEGMENT_NUMBER=0

# Maximum vectors per segment in KB (default 200MB)
# Larger segments = more throughput, slower to build
MAX_SEGMENT_SIZE=200000

# Vector distance metric: COSINE (default), EUCLID, or DOT
VECTOR_DISTANCE_METRIC=COSINE

# HNSW search parameter (higher = more accurate but slower, range: 1-512)
# Default 128 is a good balance. Use 256+ for higher recall.
SEARCH_HNSW_EF=256

# Use exact search instead of HNSW approximation (true/false)
# WARNING: Exact search is MUCH slower, only use for small collections
SEARCH_EXACT=false

# ======================================================================
#                     LLM and Rerank Model Settings
# ======================================================================

# HF token, needs access to inference provide role
HUGGINGFACE_API_KEY=

# Optional, for use with dense vector models and LLMs
AZURE_OPENAI_ENDPOINT=
AZURE_OPENAI_KEY=

# ======================================================================
#                         Postgres Settings
# ======================================================================

# Connection info for sidecar Postgres
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=evidencelab
POSTGRES_PASSWORD=changeme
# Prefer POSTGRES_DBNAME; POSTGRES_DB is a legacy alias.
POSTGRES_DBNAME=evidencelab
POSTGRES_DB=evidencelab

# ======================================================================
#                           Pipeline Settings
# ======================================================================

# Where DB files and backups are saved. Cannot be symlink.
DB_DATA_MOUNT=

# Needed for Azure container apps deploy (if used) and sync script
STORAGE_ACCOUNT_NAME=
STORAGE_SHARE_NAME=
STORAGE_ACCOUNT_KEY=
